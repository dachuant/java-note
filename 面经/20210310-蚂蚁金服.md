# 20210310-蚂蚁金服一面

1. 自我介绍，介绍项目？做了这么多项目，讲一下哪个项目最影响深刻？难点是什么？

2. 缓存数据一致性问题？先删除缓存还是先更新数据库？

   > 先删除缓存，如果先更新数据库，后续遇到更新缓存失败的话，会有数据不一致问题

3. redis 的分布式锁是怎么实现的？zookeeper分布式锁的实现？

4. Redis 海量key, get * 会有问题吗？

   > get * ,keys * 会有性能问题，数据量大时，会变量所有数据，单线程会阻塞，而且没有分页功能
   >
   >  正式环境禁用 keys 
   >
   > 
   >
   > 可以有scan
   >
   > SCAN 的使用
   > 语法：SCAN cursor [MATCH pattern] [COUNT count] [TYPE type]
   >
   > SCAN是基于游标的迭代器。这意味着在每次调用该命令时，服务器都会返回相应的查询数据和一个新的游标，用户需要将该游标用作下一个调用中的游标参数。
   >
   > 游标设置为0时，迭代将开始，服务器返回的游标为0时，迭代将终止。
   >
   > 参数说明：
   >
   > cursor: 游标位置，整数值；从 0 开始，到 0 结束；查询的结果有可能是0个，但游标不为 0, 只要游标不为 0，就代表遍历还没有结束。
   > match pattern: 正则匹配字段 （可选）
   > count: 限定单次扫描的数量 limit hint（相当于一个小的增量），默认为10。其并不是查询结果返回的最大数量。比如 count 为 10000，意味着每次扫描 1w 条记录，但是有可能只有 10 条符合条件。（可选）
   >
   > 注意事项：
   >
   > 游标是一个 Hash 值，是乱序的，一个遍历从 从 0 开始，到 0 结束，意味着重新返回起点。
   > 无需为每次迭代使用相同的COUNT值。只要在下一次遍历时是传入上一次的获得的游标即可，这样下一次遍历会使用上一次的 COUNT 值。
   > scan 返回的结果可能会有重复数据，需要客户端去重

5. redis 持久化机制？AOF,RDB
6. redis 的rehash和hashMap的rehash有什么区别？
7. jdk1.7, jdk1.8 hashmap区别？
8. synchronize 使用场景及原理，是可重入的吗？reentranceLock用过吗，讲一下？
9. 线程池的参数及原理？为什么不用无界阻塞队列？
10. ThreadLocal源码？使用场景？会有什么问题？
11. spring cloud 有几大组件？Hytrix降级参数？Eureka 心跳检查怎么剔除服务？
12. fegin 如何做负载均衡？
13. spring cloud 的重试机制？参数？重试的时候怎么做幂等？
14. 项目中的分库分表？分库分表带来的问题？
15. 分布式事务？TCC的实现？
16. 数据库查询慢问题排查？可能的原因？
17. 分库分表的时候join 查询怎么办？
18. Mysql的主从复制原理？主从数据一致性？sharding 设置主从复制只读主库？
19. RPC 与spring cloud 的区别？
20. /*
     问题：实现一个转账账务业务，要求：
        a. 记录转账双方账务变化
        b. 记录转账流水
        c. 上述都成功后，整个事务完成
        DAL使用mock代替，只体现业务流程实现。需要考虑事务中异常或失败的情况，以及避免死锁。
    */

